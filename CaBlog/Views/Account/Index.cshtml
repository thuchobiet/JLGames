@model IEnumerable<CaBlog.Models.ACCOUNT>

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}

@section css{
    <link id="style" href="@Url.Content("~/Content/jquery-confirm.css")" rel="stylesheet" media="screen">
}

@section title{
    Account
}

<table id="grid-basic" class="table table-condensed table-hover table-striped">
    <thead>
        <tr>
            <th data-column-id="id" data-type="numeric">ID</th>
            <th data-column-id="username">Tên Đăng Nhập</th>            
            <th data-column-id="ngaytao" data-order="desc">Ngày Tạo</th>
            <th data-column-id="dangsudung" data-sortable="false">Kích Hoạt</th>
            <th data-column-id="commands" data-formatter="commands" data-order="desc" data-sortable="false"></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>@item.id</td>
                <td>@item.username</td>                
                <td>@item.ngaytao.ToString("dd-MM-yyyy HH:mm:ss")</td>
                <td>@item.dangsudung</td>
            </tr>
        }
    </tbody>
</table>

<div id="message" class="alert alert-warning"></div>

@section scripts{
    <script src="@Url.Content("~/Scripts/jquery-confirm.min.js")"></script>

    <script>
        $("#grid-basic").bootgrid({
            formatters: {
                "commands": function (column, row) {
                    return "<button type=\"button\" class=\"btn btn-xs btn-default command-edit\" data-row-id=\"" + row.id + "\"><span class=\"fa fa-pencil\"></span></button> " +
                        "<button type=\"button\" class=\"btn btn-xs btn-default command-delete\" data-row-id=\"" + row.id + "\"><span class=\"fa fa-trash-o\"></span></button>";
                }
            }
        }).on("loaded.rs.jquery.bootgrid", function () {
            /* Executes after data is loaded and rendered */
            $("#grid-basic").find(".command-edit").on("click", function (e) {
                window.location.href = "/account/edit/" + $(this).data("row-id");
            }).end().find(".command-delete").on("click", function (e) {
                var data = { "id": $(this).data("row-id") };

                $.confirm({
                    title: false,
                    content: 'Bạn thật sự muốn xóa?',
                    confirmButton: 'Vâng',
                    cancelButton: 'Hủy',
                    theme: 'holodark',
                    confirm: function () {
                        $("#message").html("Đang kiểm tra...");
                        $.ajax({
                            url: "/account/DeleteAjax",
                            type: 'POST',
                            data: JSON.stringify(data),
                            dataType: "json",
                            contentType: "application/json",
                            success: function (result) {
                                if (result.status) {
                                    $("#message").html("Xóa thành công");
                                    window.location.href = result.message;
                                }
                                else {
                                    $("#message").html(result.message);
                                }
                            },
                            error: function () {
                                $("#message").html("Lỗi kết nối");
                            }
                        });
                    }
                });
            });
        });

    </script>
}